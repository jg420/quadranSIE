/* 
 * Copyright (C) 2016 g.juillerot
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */


var pathCentrale = hostPath_dev + "central/";

var centrales = []; //sert a afficher toutes les centrales 

centrales['lib_direction'] = []; // lib direction ex: DR SUD - METHANERGY
centrales['id_centrale'] = [];  //id_centrale
centrales['lib_centrale'] = [];  //lib_centrale
centrales['lib_puissance'] = []; //lib puissance en kWh
centrales['lib_societe_principale'] = []; //lib societe
centrales['code_ana'] = []; //code analytique

var details_centrale = []; // sert a afficher une centrale en particulier
details_centrale['lib_centrale'] = [];  //lib_centrale
details_centrale['lib_direction'] = []; // lib direction ex: DR SUD - METHANERGY
details_centrale['lib_centrale'] = [];  //lib_centrale
details_centrale['code_ana'] = [];  //code analytique
details_centrale['lib_societe_principale'] = []; //lib societe
details_centrale['lib_puissance']
details_centrale['lib_type'] = [];  //lib_type
details_centrale['id_cex'] = [];  //id_cex
details_centrale['lib_cex'] = [];  //lib_cex en trigrame ex: LNI
details_centrale['id_direction'] = []; // id_direction



//pour l'autocomplétion
var cex = [];
cex['id_cex'] = [];    //id_cex
cex['lib_cex'] = [];    //lib_cex

//pour l'autocomplétion
var type_centrale = [];
type_centrale['id_type_centrale'] = [];
type_centrale['lib_type_centrale'] = [];

//pour l'autocomplétion
var directions = [];
directions['id_direction'] = [];
directions['lib_direction'] = [];


var id_centrale = "";  //equipement en cours

var new_centrale = false;

$(document).ready(function () {

    $('#lien_menu_central').attr("class", "active");

    fc_charge_parametre_initial();
    fc_charge_tout_les_centrales();
    fc_affiche_toutes_les_centrales();


    fc_affiche_panel_par_defaut();
    
    /*fc_gere_evenement_partie_details_central();
    fc_gere_evenement_partie_equipements_central();
    fc_gere_evenement_partie_prestataire_central();*/
    fc_gere_evenement_partie_apercu_central();
    

 
});
function fc_affiche_panel_par_defaut(){
    $('#lien_menu_centrale').attr("class", "active");
}
function  fc_gere_evenement_partie_apercu_central(){
     alert('ici c bon');
    $('#btn_ajout_schema_central').click(function(){
        alert('ici c bon');
        fc_affiche_input_partie_apercu_central();
    });
    $('#btn_valid_ajout_apercu').click(function(){});
    $('#btn_annule_ajout_apercu').click(function(){
        fc_cache_input_partie_apercu_central();
    });
}
function fc_gere_evenement_partie_details_central(){
    $('#btn_modif_info_central').click(function(){
        fc_affiche_input_partie_details_central();
    });
    
    $('#btn_annule_modif_details_central').click(function(){
        fc_cache_input_partie_details_central();
    });
}
function fc_gere_evenement_partie_prestataire_central(){
    $('#btn_modif_presta_central').click(function(){
        fc_affiche_input_prestataire_central();
    });
    $('#btn_annule_modif_presta_central').click(function(){
        fc_cache_input_prestataire_central();
    });
  }  
  
 

function fc_affiche_input_partie_details_central(){
    $('#direction').attr('disabled','false');
    $('#cex').attr('disabled','false');
    $('#val_adresse_postal').attr('disabled','false');
    $('#societe_principale').attr('disabled','false');
    $('#puissance_estimee').attr('disabled','false');
    $('#btn_valid_modif_details_central').attr('style','visibility:visible');
    $('#btn_annule_modif_details_central').attr('style','visibility:visible');
}
function fc_cache_input_partie_details_central(){
    $('#direction').attr('disabled','true');
    $('#cex').attr('disabled','true');
    $('#val_adresse_postal').attr('disabled','true');
    $('#societe_principale').attr('disabled','true');
    $('#puissance_estimee').attr('disabled','true');
    $('#btn_valid_modif_details_central').attr('style','visibility:hidden');
    $('#btn_annule_modif_details_central').attr('style','visibility:hidden');
}

 
function fc_affiche_input_prestataire_central(){
  
}
function fc_cache_input_prestataire_central(){
     
}

function fc_affiche_input_partie_apercu_central(){
    $('#titre_nouvelle_apercu').attr('style','visibility:visible');
    $('#lib_apercu').attr('style','visibility:visible');
    $('#btn_valid_ajout_apercu').attr('style','visibility:visible');
    $('#btn_annule_ajout_apercu').attr('style','visibility:visible');
}
function fc_cache_input_partie_apercu_central(){
     $('#titre_nouvelle_apercu').attr('style','visibility:hidden');
    $('#lib_apercu').attr('style','visibility:hidden');
    $('#btn_valid_ajout_apercu').attr('style','visibility:hidden');
    $('#btn_annule_ajout_apercu').attr('style','visibility:hidden');
}


function fc_charge_parametre_initial() {
    $('#lien_page_centrale').attr('href', pathCentrale);
}
;

function fc_charge_tout_les_centrales() {
    $.ajax({
        method: 'GET',
        async: false,
        url: pathCentrale + 'getAll',
        //  data: {'id_central':id_central},
        dataType: 'json', // on veut un retour JSON
        success: function (json) {
            var i = 0;

            $.each(json, function (index, value) { // pour chaque noeud JSON
                centrales['id_centrale'][index] = value.id_central;
                centrales['lib_centrale'][index] = value.lib_central;



                centrales['lib_direction'][index] = value.lib_direction;
                centrales['lib_societe_principale'][index] = value.lib_societe;
                centrales['code_ana'][index] = value.code_ana;




                //details_centrale['id_type'][index]=value.id_type;
                //centrales['lib_type'][index]=value.lib_type;

                //fc_cherche_et_charge_details_centrale(value.id_centrale);


                i++;
            });
        },
        error: function () {
        }
    });
}
;

function fc_cherche_et_charge_details_centrale(i) {


    $.ajax({
        method: 'GET',
        async: false,
        url: pathCentrale + 'get_info_centrale',
        dataType: 'json', // on veut un retour JSON
        success: function (json) {
            var i = 0;

            $.each(json, function (index, value) { // pour chaque noeud JSON
                centrales['id_centrale'][index] = value.id_central;
                centrales['lib_centrale'][index] = value.lib_central;

                centrales['lib_direction'][index] = value.lib_direction;


                centrales['code_ana'][index] = value.code_ana;
                centrales['lib_societe_principale'][index] = value.lib_societe;


                centrale['id_direction'][index] = value.id_direction;
                details_centrale['id_type'][index] = value.id_type;
                centrales['lib_type'][index] = value.lib_type;
                centrales['id_cex'][index] = value.id_cex;
                centrales['lib_cex'][index] = value.lib_cex;



            });
        },
        error: function () {
        }
    });
}
;
function fc_affiche_toutes_les_centrales() {
    //$('#lib_centrale1').val(centrales['lib_centrale'[i]]);

    for (var i = 0; i < centrales['lib_centrale'].length; i++) {
        var lib_central = '#lib_central' + i;
        //  $('t:nth-child('+i+')').append("centrales['lib_centrale']");
        $(lib_central).append(centrales['lib_centrale'][i]);


        /*var id_constructeur='#id_constructeur'+i;
         $(id_constructeur).val(centrales['id_constructeur'][i]);*/

        var lib_direction = '#lib_dr' + i;
        //$(lib_direction).val('fff');
        $(lib_direction).append(
                //$(lib_direction).append("<option id=" + centrales['id_constructeur'][i] + ">" +
                centrales['lib_direction'][i]
                );

        /* var libCentrale = '#lib_centrale' + i;
         $(libCentrale).val(
         centrales['lib_centrale'][i]);
         
         var id_type='#id_type'+i;
         $(id_type).val(details_centrale['id_type'][i]);
         
         var lib_type='#lib_type'+i;
         $(lib_type).val(centrales['lib_type']);
         
         var id_version='#id_version'+i;
         $(id_version).val(centrales['id_version']);
         
         var lien_access='#lien_access'+i;
         $(lien_access).val(centrales['adresse_ip'][i]);
         */

    }

}

function fc_modifie_central() {

}

function fc_select(i) {
    //j efface l'anciene selection graphique
    $('.list-group-item').attr("class", "list-group-item list-group-item-action flex-column align-items-start");


    var v = '#lien_central' + i;
    var attribut = "list-group-item list-group-item-action flex-column align-items-start active"
    $(v).attr("class", attribut);



}

function fc_css_select_details_centrale() {
     $('#menu_information').attr("class", "active");
    $('#menu_equipement').attr("class", "");
    $('#menu_prestataire').attr("class", "");
    
    $('#informations_centrale').attr("class","tab-pane fade active in");
    $('#equipement_centrale').attr("class", "tab-pane fade");
    $('#prestataire_centrale').attr("class", "tab-pane fade");
}
function fc_css_select_prestataire_centrale() {
    /*$('#menu_details').attr("class", "");
     $('#menu_acces').attr("class", "active");
     //$('#menu_config').attr("class", "");*/

    $('#equipement_centrale').attr("class", "tab-pane fade");
    $('#prestataire_centrale').attr("class", "tab-pane fade  active in");
    $('#informations_centrale').attr("class", "tab-pane fade");
    
    $('#menu_information').attr("class", "");
    $('#menu_equipement').attr("class", "");
    $('#menu_prestataire').attr("class", "active");

}
function fc_css_select_equipement_centrale() {
    /*$('#menu_details').attr("class", "");
     $('#menu_acces').attr("class", "none");
     $('#menu_config').attr("class", "active");*/

    $('#equipement_centrale').attr("class", "tab-pane fade  active in");
    $('#prestataire_centrale').attr("class", "tab-pane fade");
    $('#informations_centrale').attr("class", "tab-pane fade");
    
     $('#menu_information').attr("class", "");
    $('#menu_equipement').attr("class", "active");
    $('#menu_prestataire').attr("class", "");
}